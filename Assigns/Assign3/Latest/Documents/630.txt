Haversine formula
The haversine formula is an equation important in navigation, giving great-circle distances between two points on a sphere from their longitudes and latitudes. It is a special case of a more general formula in spherical trigonometry, the law of haversines, relating the sides and angles of spherical "triangles".
These names follow from the fact that they are customarily written in terms of the haversine function, given by haversin(Î¸) = sin2(Î¸/2). (The formulas could equally be written in terms of any multiple of the haversine, such as the older versine function (twice the haversine). Historically, the haversine had, perhaps, a slight advantage in that its maximum is one, so that logarithmic tables of its values could end at zero. These days, the haversine form is also convenient in that it has no coefficient in front of the sin2 function.)

For two points on a sphere (of radius R) with latitudes Ï†1 and Ï†2, latitude separation Î”Ï† = Ï†1 âˆ’ Ï†2, and longitude separation Î”Î», where angles are in radians, the distance d between the two points (along a great circle of the sphere; see spherical distance) is related to their locations by the formula:
Let h denote haversin(d/R), given from above. One can then solve for d either by simply applying the inverse haversine (if available) or by using the arcsine (inverse sine) function:
In the era before the digital calculator, the use of detailed printed tables for the haversine/inverse-haversine and its logarithm (to aid multiplications) saved navigators from squaring sines, computing square roots, etc., a process both arduous and likely to exacerbate small errors (see also versine).
When using these formulae, care must be taken to ensure that h does not exceed 1 due to a floating point error (d is only real for h from 0 to 1). h only approaches 1 for antipodal points (on opposite sides of the sphere) â€” in this region, relatively large numerical errors tend to arise in the formula when finite precision is used. However, because d is then large (approaching Ï€R, half the circumference) a small error is often not a major concern in this unusual case (although there are other great-circle distance formulas that avoid this problem). (The formula above is sometimes written in terms of the arctangent function, but this suffers from similar numerical problems near h = 1.)
As described below, a similar formula can also be written in terms of cosines (sometimes called the spherical law of cosines, not to be confused with the law of cosines for plane geometry) instead of haversines, but for the common case of small distances/angles a small error in the input to the arccos function leads to a large error in the final output. This makes the formula unsuitable for general use.
This formula is only an approximation when applied to the Earth, because the Earth is not a perfect sphere: its radius R varies from 6356.78 km at the poles to 6378.14 km at the equator. There are small corrections, typically on the order of 0.1% (assuming the geometric mean R = 6367.45 km is used everywhere), because of this slight ellipticity of the planet. A more accurate method, which takes into account the Earth's ellipticity, is given by Vincenty's formulae.

Given a unit sphere, a "triangle" on the surface of the sphere is defined by the great circles connecting three points u, v, and w on the sphere. If the lengths of these three sides are a (from u to v), b (from u to w), and c (from v to w), and the angle of the corner opposite c is C, then the law of haversines states:
Since this is a unit sphere, the lengths a, b, and c are simply equal to the angles (in radians) subtended by those sides from the center of the sphere (for a non-unit sphere, each of these arc lengths is equal to its central angle multiplied by the radius of the sphere).
In order to obtain the haversine formula of the previous section from this law, one simply considers the special case where u is the north pole, while v and w are the two points whose separation d is to be determined. In that case, a and b are Ï€/2 - Ï†1,2 (i.e., 90Â° âˆ’ latitude), C is the longitude separation Î”Î», and c is the desired d/R. Noting that sin(Ï€/2 - Ï†) = cos(Ï†), the haversine formula immediately follows.
To derive the law of haversines, one starts with the spherical law of cosines:
As mentioned above, this formula is an ill-conditioned way of solving for c when c is small. Instead, we substitute the identity that cos(Î¸) = 1 âˆ’ 2 haversin(Î¸), and also employ the addition identity cos(a âˆ’ b) = cos(a) cos(b) + sin(a) sin(b), to obtain the law of haversines, above.


